<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>MyShark</title>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" type="text/css" href="mystyle.css">
    <script src="./js/jquery-1.8.2.js" type="text/javascript" charset="utf-8"></script>
    <script src="./js/doc.js" type="text/javascript" charset="utf-8"></script>
    <link rel="stylesheet" href="./textext/css/textext.core.css" type="text/css"/>
    <link rel="stylesheet" href="./textext/css/textext.plugin.autocomplete.css" type="text/css"/>
    <link rel="stylesheet" href="./textext/css/textext.plugin.focus.css" type="text/css"/>
    <link rel="stylesheet" href="./textext/css/textext.plugin.arrow.css" type="text/css"/>
    <script src="./textext/js/textext.core.js" type="text/javascript" charset="utf-8"></script>
    <script src="./textext/js/textext.plugin.autocomplete.js" type="text/javascript" charset="utf-8"></script>
    <script src="./textext/js/textext.plugin.focus.js" type="text/javascript" charset="utf-8"></script>
    <script src="./textext/js/textext.plugin.ajax.js" type="text/javascript" charset="utf-8"></script>
    <script src="./textext/js/textext.plugin.arrow.js" type="text/javascript" charset="utf-8"></script>
    <style>
        #textarea2 {
            width: 300px;
            height: 25px;
            font-size: 13pt;
        }

        div.text-core {
            float: left;
        }

        table#example3 td.center {
            text-align: center;
        }

        table#example3 {
            font-size: 9pt;
            width: 100%;
        }

        body#mysh {
            font-size: 14pt;
            font-family: sans-serif;
        }

        div.ui-datepicker, .ui-datepicker td {
            font-size: 12px;
        }
    </style>
    <script type="text/javascript">
        var nome = '';
        var id = -1;
        $(document).ajaxStart(function () {
            $("#wait").css("display", "block");
        });

        $(document).ajaxComplete(function () {
            $("#wait").css("display", "none");
        });

        $(function () {
            $('#textarea2').on('hideDropdown', function (data) {
                //  var m=$('#textarea2').textext()[0];
                var out = $('#textarea2').val().split(',');
                nome = out[0];
                id = out[1];
                $('#textarea2').val('');
                cerca();
            });
        });
        function cerca() {
            $.ajax({
                type: "GET",
                url: "ajaxsh.php",
                contentType: "application/json; charset=utf-8",
                //data: {q : res[0], p : poker, c : cat, t: tempo},
                data: {id: id},
                datatype: "json",
                error: function (textStatus, errorThrown) {

                    // alert('Nessun risultato per i filtri selezionati!');
                },
                success: function (result) {

                    $("#intest").html(nome);

                    var id_prec = -1;
                    var usc = '';
                    result.forEach(function (entry) {
                        if (id_prec !== entry.fotocop_id) {
                            if (usc !== '')
                                usc += '</table>';
                            usc += '<table><thead><th>Mese</th><th>Anno</th><th>Fotocopie</th><th>Differenza</th></thead>';
                            id_prec = entry.fotocop_id;
                        }
                        usc += '<tr><td>' + entry.mese + '</td></tr>';
                    });
                    usc += '</table>';
                    $("#output").html(usc);
                    $('#textarea2').blur();
                }
            })
        }

    </script>

</head>
<body id="mysh" class="">

<div style="width:390px;height: 50px">
    <div style="float: left;margin-right: 10px">Cerca:</div>
    <textarea title="" id="textarea2" class="example" rows="1"></textarea>
    <div id="wait" style="float: right;display: none"><img src="./textext/spinner.gif"></div>
</div>
<div id="intest"></div>
<div id="input"></div>
<div id="output"></div>

<script type="text/javascript">

    $("#textarea2").focus(function () {
        var $this = $(this);
        $this.select();

        // Work around Chrome's little problem
        $this.mouseup(function () {
            // Prevent further mouseup intervention
            $this.unbind("mouseup");
            return false;
        });
    });
    $('#textarea2')
        .textext({
            plugins: 'arrow autocomplete ajax focus prompt',
            prompt: 'Cliente',
            ajax: {
                url: 'sugg.php',
                dataType: 'json',
                cacheResults: false
            },
            autocomplete: {
                dropdownMaxHeight: '600px',

                render: function (suggestion) {

                    var out = suggestion.split(',');
                    return '<div style="height:25px;font-size: 13pt">' + out[0] + '</div>';
                }
            }

        });

</script>

</body>
</html>
